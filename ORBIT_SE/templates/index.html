<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ORBIT</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; box-sizing: border-box; }
    body { margin: 0; padding: 1rem; display: flex; height: 100vh;}
.main-content {
  flex: 1;
  overflow-y: auto;
}    header.header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    header.header h1 { font-family: 'Orbitron', sans-serif; font-size: 2rem; margin: 0; }
    form.searchbar { display: flex; gap: 0.5rem; flex-grow: 1; max-width: 600px; }
    form.searchbar input { flex-grow: 1; padding: .5rem; border: 1px solid #ccc; border-radius: .25rem; }
    form.searchbar button { padding: .5rem 1rem; border: none; background-color: #007bff; color: white; border-radius: .25rem; cursor: pointer; }
    form.searchbar button:hover { background-color: #155ab6; }
    hr { margin: 1rem 0; border-color: #eee; }
    .results-list { display: flex; flex-direction: column; gap: 1.5rem; }
    .book-entry { border-bottom: 1px solid #eee; padding-bottom: 1rem; display: grid; grid-template-columns: 1fr auto; align-items: start; gap: 1rem; }
    .book-meta h5 { margin: 0 0 .3rem 0; font-weight: 600; }
    .book-meta p { margin: .2rem 0; color: #444; }
    .badge { background-color: #eee; color: #555; padding: .15rem .5rem; border-radius: .3rem; font-size: .75rem; margin-right: .3rem; }
    .btn-details { background: none; border: none; color: #1a73e8; cursor: pointer; font-size: .9rem; text-decoration: underline; padding: 0; }
    .btn-details:hover { color: #155ab6; }
    /* Offcanvas als dauerhaft sichtbares Seitenpanel */
    .offcanvas-end {
      visibility: visible !important;
      transform: none !important;
      position: relative;
      top: 0;
      height: auto;
      border-left: 1px solid #ccc;
      box-shadow: -3px 0 10px rgba(0,0,0,0.1);
      padding: 1rem;
      width: 400px; max-width: 90vw;
      overflow-y: auto;
      overflow-x: hidden; /* Verhindert horizontales Scrollen */
      white-space: normal; /* Zeilen umbrechen, damit keine horizontale Ausdehnung */


    }
    .offcanvas-body { padding: 0; overflow-x: hidden;
  overflow-y: auto;
  white-space: normal;}
    .offcanvas-header { padding: 0; border-bottom: none; }
    .offcanvas-end.custom-width {
        width: 40% !important;
        max-width: none;
    }
    ul {
        list-style: none;
        padding-left: 0;
    }

    li a {
        display: inline-block;
        padding: 6px 12px;
        margin: 4px 0;
        background-color: #f0f0f0;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        transition: background 0.2s ease;
    }

    li a:hover {
        background-color: #d0e0ff;
    }
    .facets-container {
  margin: 1em 0;
}

.facet-group {
  margin-bottom: 1.5em;
}

.facet-group h3 {
  margin-bottom: 0.5em;
  font-weight: bold;
}

.facet-values {
  display: flex;
  flex-wrap: wrap;       /* wichtig für Umbruch */
  gap: 0.5em;            /* Abstand zwischen Badges */
}

.facet-badge {
  background-color: #e0e0e0;
  color: #333;
  padding: 0.3em 0.8em;
  border-radius: 15px;
  text-decoration: none;
  font-size: 0.7em;
  white-space: nowrap;
  transition: background-color 0.3s;
}

.facet-badge:hover {
  background-color: #bdbdbd;
  color: #000;
}
.offcanvas-body dd {
  margin-left: 0; /* entfernt unnötigen extra-Einzug, optional */
}
.offcanvas-body dt {
  margin-right: 0; /* entfernt unnötigen extra-Einzug, optional */
}
.offcanvas-body dt,
.offcanvas-body dd {
  margin-bottom: 0.2rem;
  font-size: 0.95rem;
}
  </style>
</head>
<body>

    <div class="main-content">
        <header class="header">
        <h1>ORBIT</h1>

        <form method="GET" action="/search" class="searchbar">
            <input type="text" name="query" placeholder="Enter Query" value="{{ query or '' }}" />
            <button type="submit">Search</button>
        </form>
        </header>

        <hr />


        <p>
        {% if num_of_hits == 1 %}
            Es wurde <strong>1</strong> Treffer gefunden.
        {% else %}
            Es wurden <strong>{{ num_of_hits }}</strong> Treffer gefunden.
        {% endif %}
        </p>


        {% if facets %}
        <div class="facets-container">
            {% for field, values in facets.items() %}
            <div class="facet-group">
                <b>{{ field }}</b>
                <div class="facet-values">
                {% for i in range(0, values|length, 2) %}
                    <a href="{{ url_for('search', query=query, **{ 'filter_' + field: values[i] }) }}" class="facet-badge">
                    {{ values[i] }} ({{ values[i+1] }})
                    </a>
                {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Keine Facetten vorhanden.</p>
        {% endif %}

        <hr />

        <div class="results-list">
        {% for result in results %}
        <div class="book-entry">
            <div class="book-meta">
            <h5>({{ loop.index + 10 * (page - 1) }}) {{ result.title }}</h5>
            <p>{{ ", ".join(result.author_names) }}</p>
            <p>
                <small>Published: {{ result.published }}</small><br>
                <small> Cited by: {{ result.cited_by_count }}</small><br>
                <button class="btn-details"
                    data-title="{{ result.title|e }}"
                    data-summary="{{ result.summary[0]|e if result.summary else 'Keine Zusammenfassung vorhanden.' }}"
                    data-arxivid="{{ result.arxiv_id|e }}"
                    data-openalexid="{{ result.openalex_id|e }}"

                >Mehr</button>
            </p>
            <div class="mt-2">
                {% for subject in result.subjects %}
                <span class="badge">{{ subject }}</span>
                {% endfor %}
            </div>
            </div>
        </div>
        {% endfor %}
        </div>


        {% if results %}
        <nav class="navbar bg-light mt-4">
        <div class="container">
            <ul class="navbar-nav mx-auto flex-row">
            {% if page > 1 %}
            <li class="nav-item me-2">
                <a class="nav-link" href="/search?query={{ query }}&page={{ page - 1 }}">← Zurück</a>
            </li>
            {% endif %}
            {% if page < total_pages %}
            <li class="nav-item">
                <a class="nav-link" href="/search?query={{ query }}&page={{ page + 1 }}">Weiter →</a>
            </li>
            {% endif %}
            </ul>
        </div>
        </nav>
        {% endif %}


        {% if suggestions %}
        <div style="margin-top: 20px;">
            <p><strong>Meintest du vielleicht:</strong></p>
            <ul>
                {% for word, freq in suggestions %}
                    <li>
                            <a href="{{ url_for('search') }}?query={{ word|urlencode }}&suggested=true">
                            {{ word }} ({{ freq }})
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}



    </div>





        <!-- Rechts sichtbares Panel -->
    <div class="offcanvas offcanvas-end custom-width" tabindex="-1" id="summaryCanvas">
        <div class="offcanvas-header">
        <h5 id="summaryLabel">Information</h5>
        </div>
        <div class="offcanvas-body">
        <dl class="row">
        <dt class="col-sm-3">Titel:</dt>
        <dd class="col-sm-9" id="summaryTitle"></dd>

        <dt class="col-sm-3">Summary:</dt>
        <dd class="col-sm-9" id="summaryBody"></dd>

        <dt class="col-sm-3">Arxiv:</dt>
        <dd class="col-sm-9"><a href="#" id="summaryArxivId" target="_blank"></a></dd>

        <dt class="col-sm-3">OpenAlex:</dt>
        <dd class="col-sm-9"><a href="#" id="summaryOpenalexId" target="_blank"></a></dd>
    </div>
    </div>





  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.querySelectorAll('.btn-details').forEach(btn => {
  btn.addEventListener('click', () => {
    document.getElementById('summaryTitle').textContent = btn.dataset.title;
    document.getElementById('summaryBody').textContent  = btn.dataset.summary;
    document.getElementById('summaryArxivId').textContent    = btn.dataset.arxivid;
    const linkEl_arxiv = document.getElementById('summaryArxivId');
    linkEl_arxiv.href = btn.dataset.arxivid || '#';
    document.getElementById('summaryOpenalexId').textContent    = btn.dataset.openalexid;
    const linkEl_openalex = document.getElementById('summaryOpenalexId');
    linkEl_openalex.href = btn.dataset.openalexid || '#';
  });
});
  </script>
</body>
</html>
