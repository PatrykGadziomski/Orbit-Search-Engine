<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ORBIT</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap"
      rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="static/main.css" />
  </head>
  <body>

    <div class="main-content">
      <header class="header">
        <h1><a href="/"
            style="text-decoration: none; color: inherit; font-family: 'Orbitron', sans-serif; font-size: 2rem; margin: 0;">ORBIT</a></h1>

        <form method="GET" action="/search" class="searchbar">
          <input type="text" name="query" placeholder="Enter Query"
            value="{{ query or '' }}" />
          <button type="submit">Search</button>
        </form>
      </header>

      <p>
        {% if num_of_hits == 1 %}
        <strong>1</strong> result found
        {% else %}
        {% if results %}
        <strong>{{ num_of_hits }}</strong> results found
        {% endif %}
        {% endif %}
      </p>

      {% if facets %}
      <div class="facets-container d-flex flex-wrap gap-2">
        {% for field, values in facets.items() %}
        <div class="dropdown mb-2">
          <button class="btn btn-outline-secondary dropdown-toggle"
            type="button" data-bs-toggle="dropdown" aria-expanded="false">
            {{ field }}
          </button>
          <ul class="dropdown-menu">
            {% for i in range(0, values|length, 2) %}
            <li>
              <a class="dropdown-item"
                href="{{ request.full_path }}&filter_{{ field }}={{ values[i] | urlencode }}">
                {{ values[i] }} ({{ values[i+1] }})
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      {% if results %}
      <hr />
      {% endif %}

      <div class="results-list">
        {% for result in results %}
        <div class="paper-entry">
          <div class="paper-meta">
            <h5>({{ loop.index + 10 * (page - 1) }}) {{ result.title[0] }}</h5>
            <p>{{ "; ".join(result.authorships_names[:2]) }}; et al.</p>
            <p>
              <small>Published: {{ result.published }}</small><br>
              <small> Cited by: {{ result.cited_by_count }}</small><br>
              <button class="btn-details"
                data-title="{{ result.title[0]|e }}"
                data-author="{{ '; '.join(result.authorships_names)|e }}"
                data-published="{{ result.published|e }}"
                data-updated="{{ result.updated|e }}"
                data-summary="{{ result.summary[0]|e if result.summary else 'No summary existing.' }}"
                data-arxivid="{{ result.arxiv_id|e }}"
                data-openalexid="{{ result.openalex_id|e }}"
                data-doi="{{ result.doi|e if result.doi else 'No doi existing' }}"
                data-citations="{{ result.cited_by_count|e }}"
                data-type="{{ result.type|e }}"
                data-biblio="Volume: {{ result.volume|e }}, Issue: {{ result.issue|e }}, Pages: {{ result.first_page|e }}-{{ result.last_page|e }}"
                data-journal="{{ result.journal|e if result.journal else 'No journal existing' }}"
                data-oa="{{ result.open_access[0]|e }}"
                data-pdf="{{ result.pdf_link|e }}"
                data-lang="{{ result.language[0]|e }}"
                data-institutions="{{ result.institutions|e if result.institutions else 'No institution existing' }}">Mehr</button>
            </p>
            <div class="mt-2">
              {% for subject in result.subjects %}
              <span class="badge">{{ subject }}</span>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      {% if results %}
      <nav class="navbar bg-light mt-4">
        <div class="container">
          <ul class="navbar-nav mx-auto flex-row">
            {% if page > 1 %}
            <li class="nav-item me-2">
              <a class="nav-link"
                href="/search?query={{ query }}&page={{ page - 1 }}">← Back</a>
            </li>
            {% endif %}
            {% if page < total_pages %}
            <li class="nav-item">
              <a class="nav-link"
                href="/search?query={{ query }}&page={{ page + 1 }}">Next →</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </nav>
      {% endif %}

      {% if suggestions %}
      <div style="margin-top: 20px;">
        <p><strong>Did you mean:</strong></p>
        <ul class="suggestions-list">
          {% for word, freq in suggestions %}
          <li>
            <a
              href="{{ url_for('search') }}?query={{ word|urlencode }}&suggested=true">
              {{ word }} ({{ freq }})
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>

    <div class="offcanvas offcanvas-end custom-width" tabindex="-1"
      id="summaryCanvas">
      <div class="offcanvas-body">
        {% if not results %}
        <div style="text-align:center; margin-top: 4rem;">
          <img src="/static/placeholder.png" alt="Logo">
        </div>
        {% endif %}
        {% if results %}
        <dl class="row">
          <dt class="col-sm-3">Title:</dt>
          <dd class="col-sm-9" id="title"></dd>

          <dt class="col-sm-3">Authors:</dt>
          <dd class="col-sm-9" id="author"></dd>

          <dt class="col-sm-3">Summary:</dt>
          <dd class="col-sm-9" id="summary"></dd>

          <dt class="col-sm-3">Published:</dt>
          <dd class="col-sm-9" id="published"></dd>

          <dt class="col-sm-3">Updated:</dt>
          <dd class="col-sm-9" id="updated"></dd>

          <dt class="col-sm-3">Arxiv:</dt>
          <dd class="col-sm-9"><a href="#" id="arxivId"
              target="_blank"></a></dd>

          <dt class="col-sm-3">OpenAlex:</dt>
          <dd class="col-sm-9"><a href="#" id="openalexId"
              target="_blank"></a></dd>

          <dt class="col-sm-3">Doi:</dt>
          <dd class="col-sm-9" id="doi"></dd>

          <dt class="col-sm-3">Citations:</dt>
          <dd class="col-sm-9" id="citations"></dd>

          <dt class="col-sm-3">Type:</dt>
          <dd class="col-sm-9" id="type"></dd>

          <dt class="col-sm-3">Biblio:</dt>
          <dd class="col-sm-9" id="biblio"></dd>

          <dt class="col-sm-3">Journal:</dt>
          <dd class="col-sm-9" id="journal"></dd>

          <dt class="col-sm-3">Open Access:</dt>
          <dd class="col-sm-9" id="oa"></dd>

          <dt class="col-sm-3">PDF Link:</dt>
          <dd class="col-sm-9"><a href="#" id="pdf" target="_blank"></a></dd>

          <dt class="col-sm-3">Language:</dt>
          <dd class="col-sm-9" id="lang"></dd>

          <dt class="col-sm-3">Institutions:</dt>
          <dd class="col-sm-9" id="institutions"></dd>
        </dl>
        {% else %}
        <!-- empty -->
        {% endif %}
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.querySelectorAll('.btn-details').forEach(btn => {
      btn.addEventListener('click', () => {
      document.getElementById('title').textContent = btn.dataset.title;
      document.getElementById('author').textContent = btn.dataset.author;
      document.getElementById('summary').textContent  = btn.dataset.summary;
      document.getElementById('published').textContent  = btn.dataset.published;
      document.getElementById('updated').textContent  = btn.dataset.updated;
      document.getElementById('arxivId').textContent = btn.dataset.arxivid;
      const linkEl_arxiv = document.getElementById('arxivId');
      linkEl_arxiv.href = btn.dataset.arxivid || '#';
      document.getElementById('openalexId').textContent = btn.dataset.openalexid;
      const linkEl_openalex = document.getElementById('openalexId');
      linkEl_openalex.href = btn.dataset.openalexid || '#';
      document.getElementById('citations').textContent  = btn.dataset.citations;
      document.getElementById('type').textContent  = btn.dataset.type;
      document.getElementById('biblio').textContent  = btn.dataset.biblio;
      document.getElementById('journal').textContent  = btn.dataset.journal;
      document.getElementById('oa').textContent  = btn.dataset.oa;
      document.getElementById('pdf').textContent = btn.dataset.pdf;
      const linkEl_pdf = document.getElementById('pdf');
      linkEl_pdf.href = btn.dataset.pdf || '#';
      document.getElementById('lang').textContent  = btn.dataset.lang;
      document.getElementById('institutions').textContent  = btn.dataset.institutions;
      document.getElementById('doi').textContent  = btn.dataset.doi;
    });
  });
  </script>
  </body>
</html>